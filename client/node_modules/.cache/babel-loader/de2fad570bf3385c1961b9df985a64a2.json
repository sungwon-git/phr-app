{"ast":null,"code":"import _regeneratorRuntime from \"/Users/sungwonjung/dev/nodejs/phr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/sungwonjung/dev/nodejs/phr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/sungwonjung/dev/nodejs/phr/client/src/views/phr/OAuth2/index.js\";\nimport React, { useCallback, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport qs from \"query-string\";\nimport useIsMountedRef from \"src/hooks/useIsMountedRef\";\nimport Axios from \"axios\";\n\nfunction OAuth2(_ref) {\n  var location = _ref.location;\n  var isMountedRef = useIsMountedRef();\n  var organization = JSON.parse(localStorage.getItem(\"organization\")); // console.log(JSON.parse(organization));\n\n  var _qs$parse = qs.parse(location.search),\n      code = _qs$parse.code; // console.log(\"OAuth2's code \", code);\n\n\n  var getToken = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var data, client, config;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            data = {\n              code: code,\n              grant_type: \"authorization_code\",\n              redirect_uri: organization.redirectURI\n            };\n            client = Buffer.from(\"\".concat(organization.clientID, \":\").concat(organization.clientSecret), \"utf8\").toString(\"base64\");\n            config = {\n              method: \"post\",\n              url: organization.tokenURL,\n              headers: {\n                Authorization: \"Basic \".concat(client)\n              },\n              data: data,\n              withCredentials: true\n            };\n            _context2.next = 5;\n            return Axios(config).then( /*#__PURE__*/function () {\n              var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n                var oauth2, token_config;\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        if (!isMountedRef.current) {\n                          _context.next = 7;\n                          break;\n                        }\n\n                        console.log(response.data);\n                        localStorage.setItem(\"oauth2Token\", JSON.stringify(response.data.access_token));\n                        oauth2 = response.data.access_token;\n                        token_config = {\n                          method: \"post\",\n                          url: \"http://localhost:3100/token/save\",\n                          data: {\n                            userID: oauth2.patientNumber,\n                            organizationID: organization.organizationID,\n                            token: oauth2.value\n                          }\n                        };\n                        _context.next = 7;\n                        return Axios(token_config).then(function (response) {\n                          console.log(response);\n                        }).catch(function (err) {\n                          console.log(err);\n                        });\n\n                      case 7:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function (_x) {\n                return _ref3.apply(this, arguments);\n              };\n            }()).catch(function (err) {\n              console.log(\"error \", err);\n            });\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  })), [isMountedRef]);\n  useEffect(function () {\n    getToken();\n  }, [getToken]);\n  return /*#__PURE__*/React.createElement(Redirect, {\n    to: \"/phr\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 9\n    }\n  }); // return <div></div>;\n}\n\nexport default OAuth2;","map":{"version":3,"sources":["/Users/sungwonjung/dev/nodejs/phr/client/src/views/phr/OAuth2/index.js"],"names":["React","useCallback","useEffect","Redirect","qs","useIsMountedRef","Axios","OAuth2","location","isMountedRef","organization","JSON","parse","localStorage","getItem","search","code","getToken","data","grant_type","redirect_uri","redirectURI","client","Buffer","from","clientID","clientSecret","toString","config","method","url","tokenURL","headers","Authorization","withCredentials","then","response","current","console","log","setItem","stringify","access_token","oauth2","token_config","userID","patientNumber","organizationID","token","value","catch","err"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport qs from \"query-string\";\nimport useIsMountedRef from \"src/hooks/useIsMountedRef\";\nimport Axios from \"axios\";\n\nfunction OAuth2({ location }) {\n\tconst isMountedRef = useIsMountedRef();\n\tconst organization = JSON.parse(localStorage.getItem(\"organization\"));\n\n\t// console.log(JSON.parse(organization));\n\n\tlet { code } = qs.parse(location.search);\n\t// console.log(\"OAuth2's code \", code);\n\n\tconst getToken = useCallback(async () => {\n\t\tconst data = {\n\t\t\tcode: code,\n\t\t\tgrant_type: \"authorization_code\",\n\t\t\tredirect_uri: organization.redirectURI,\n\t\t};\n\n\t\tconst client = Buffer.from(`${organization.clientID}:${organization.clientSecret}`, \"utf8\").toString(\"base64\");\n\n\t\tconst config = {\n\t\t\tmethod: \"post\",\n\t\t\turl: organization.tokenURL,\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Basic ${client}`,\n\t\t\t},\n\t\t\tdata: data,\n\t\t\twithCredentials: true,\n\t\t};\n\n\t\tawait Axios(config)\n\t\t\t.then(async (response) => {\n\t\t\t\tif (isMountedRef.current) {\n\t\t\t\t\tconsole.log(response.data);\n\t\t\t\t\tlocalStorage.setItem(\"oauth2Token\", JSON.stringify(response.data.access_token));\n\n\t\t\t\t\tconst oauth2 = response.data.access_token;\n\n\t\t\t\t\tconst token_config = {\n\t\t\t\t\t\tmethod: \"post\",\n\t\t\t\t\t\turl: \"http://localhost:3100/token/save\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tuserID: oauth2.patientNumber,\n\t\t\t\t\t\t\torganizationID: organization.organizationID,\n\t\t\t\t\t\t\ttoken: oauth2.value,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t\tawait Axios(token_config)\n\t\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\t\tconsole.log(response);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.log(\"error \", err);\n\t\t\t});\n\t}, [isMountedRef]);\n\n\tuseEffect(() => {\n\t\tgetToken();\n\t}, [getToken]);\n\n\treturn <Redirect to=\"/phr\" />;\n\t// return <div></div>;\n}\n\nexport default OAuth2;\n"]},"metadata":{},"sourceType":"module"}