{"ast":null,"code":"import _regeneratorRuntime from \"/Users/sungwonjung/dev/nodejs/phr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/sungwonjung/dev/nodejs/phr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/sungwonjung/dev/nodejs/phr/client/src/views/phr/OAuth2/index.js\";\nimport React, { useCallback, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport qs from \"query-string\";\nimport useIsMountedRef from \"src/hooks/useIsMountedRef\";\nimport Axios from \"axios\";\n\nfunction OAuth2(_ref) {\n  var location = _ref.location;\n  var isMountedRef = useIsMountedRef();\n  var organization = JSON.parse(localStorage.getItem(\"organization\")); // console.log(JSON.parse(organization));\n\n  var _qs$parse = qs.parse(location.search),\n      code = _qs$parse.code; // console.log(\"OAuth2's code \", code);\n\n\n  var getToken = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var data, client, config;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            data = {\n              code: code,\n              grant_type: \"authorization_code\",\n              redirect_uri: organization.redirectURI\n            };\n            client = Buffer.from(\"\".concat(organization.clientID, \":\").concat(organization.clientSecret), \"utf8\").toString(\"base64\");\n            config = {\n              method: \"post\",\n              url: organization.tokenURL,\n              // url: \"https://localhost:8000/oauth2/token\",\n              headers: {\n                Authorization: \"Basic \".concat(client)\n              },\n              data: data,\n              withCredentials: true\n            };\n            _context.next = 5;\n            return Axios(config).then(function (response) {\n              console.log(response.data);\n              localStorage.setItem(\"oauth2Token\", JSON.stringify(response.data.access_token.value));\n            }).catch(function (err) {\n              console.log(\"error \", err);\n            });\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), [useIsMountedRef]);\n  useEffect(function () {\n    getToken();\n  }, [getToken]);\n  return /*#__PURE__*/React.createElement(Redirect, {\n    to: \"/phr\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 9\n    }\n  }); // return <div></div>;\n}\n\nexport default OAuth2;","map":{"version":3,"sources":["/Users/sungwonjung/dev/nodejs/phr/client/src/views/phr/OAuth2/index.js"],"names":["React","useCallback","useEffect","Redirect","qs","useIsMountedRef","Axios","OAuth2","location","isMountedRef","organization","JSON","parse","localStorage","getItem","search","code","getToken","data","grant_type","redirect_uri","redirectURI","client","Buffer","from","clientID","clientSecret","toString","config","method","url","tokenURL","headers","Authorization","withCredentials","then","response","console","log","setItem","stringify","access_token","value","catch","err"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,WAAhB,EAA6BC,SAA7B,QAA8C,OAA9C;AACA,SAASC,QAAT,QAAyB,kBAAzB;AACA,OAAOC,EAAP,MAAe,cAAf;AACA,OAAOC,eAAP,MAA4B,2BAA5B;AACA,OAAOC,KAAP,MAAkB,OAAlB;;AAEA,SAASC,MAAT,OAA8B;AAAA,MAAZC,QAAY,QAAZA,QAAY;AAC7B,MAAMC,YAAY,GAAGJ,eAAe,EAApC;AACA,MAAMK,YAAY,GAAGC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,cAArB,CAAX,CAArB,CAF6B,CAI7B;;AAEA,kBAAeV,EAAE,CAACQ,KAAH,CAASJ,QAAQ,CAACO,MAAlB,CAAf;AAAA,MAAMC,IAAN,aAAMA,IAAN,CAN6B,CAO7B;;;AAEA,MAAMC,QAAQ,GAAGhB,WAAW,wEAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AACtBiB,YAAAA,IADsB,GACf;AACZF,cAAAA,IAAI,EAAEA,IADM;AAEZG,cAAAA,UAAU,EAAE,oBAFA;AAGZC,cAAAA,YAAY,EAAEV,YAAY,CAACW;AAHf,aADe;AAOtBC,YAAAA,MAPsB,GAObC,MAAM,CAACC,IAAP,WAAed,YAAY,CAACe,QAA5B,cAAwCf,YAAY,CAACgB,YAArD,GAAqE,MAArE,EAA6EC,QAA7E,CAAsF,QAAtF,CAPa;AAStBC,YAAAA,MATsB,GASb;AACdC,cAAAA,MAAM,EAAE,MADM;AAEdC,cAAAA,GAAG,EAAEpB,YAAY,CAACqB,QAFJ;AAGd;AACAC,cAAAA,OAAO,EAAE;AACRC,gBAAAA,aAAa,kBAAWX,MAAX;AADL,eAJK;AAOdJ,cAAAA,IAAI,EAAEA,IAPQ;AAQdgB,cAAAA,eAAe,EAAE;AARH,aATa;AAAA;AAAA,mBAoBtB5B,KAAK,CAACsB,MAAD,CAAL,CACJO,IADI,CACC,UAACC,QAAD,EAAc;AACnBC,cAAAA,OAAO,CAACC,GAAR,CAAYF,QAAQ,CAAClB,IAArB;AACAL,cAAAA,YAAY,CAAC0B,OAAb,CAAqB,aAArB,EAAoC5B,IAAI,CAAC6B,SAAL,CAAeJ,QAAQ,CAAClB,IAAT,CAAcuB,YAAd,CAA2BC,KAA1C,CAApC;AACA,aAJI,EAKJC,KALI,CAKE,UAACC,GAAD,EAAS;AACfP,cAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBM,GAAtB;AACA,aAPI,CApBsB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,IA4BzB,CAACvC,eAAD,CA5ByB,CAA5B;AA8BAH,EAAAA,SAAS,CAAC,YAAM;AACfe,IAAAA,QAAQ;AACR,GAFQ,EAEN,CAACA,QAAD,CAFM,CAAT;AAIA,sBAAO,oBAAC,QAAD;AAAU,IAAA,EAAE,EAAC,MAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAP,CA3C6B,CA4C7B;AACA;;AAED,eAAeV,MAAf","sourcesContent":["import React, { useCallback, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport qs from \"query-string\";\nimport useIsMountedRef from \"src/hooks/useIsMountedRef\";\nimport Axios from \"axios\";\n\nfunction OAuth2({ location }) {\n\tconst isMountedRef = useIsMountedRef();\n\tconst organization = JSON.parse(localStorage.getItem(\"organization\"));\n\n\t// console.log(JSON.parse(organization));\n\n\tlet { code } = qs.parse(location.search);\n\t// console.log(\"OAuth2's code \", code);\n\n\tconst getToken = useCallback(async () => {\n\t\tconst data = {\n\t\t\tcode: code,\n\t\t\tgrant_type: \"authorization_code\",\n\t\t\tredirect_uri: organization.redirectURI,\n\t\t};\n\n\t\tconst client = Buffer.from(`${organization.clientID}:${organization.clientSecret}`, \"utf8\").toString(\"base64\");\n\n\t\tconst config = {\n\t\t\tmethod: \"post\",\n\t\t\turl: organization.tokenURL,\n\t\t\t// url: \"https://localhost:8000/oauth2/token\",\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Basic ${client}`,\n\t\t\t},\n\t\t\tdata: data,\n\t\t\twithCredentials: true,\n\t\t};\n\n\t\tawait Axios(config)\n\t\t\t.then((response) => {\n\t\t\t\tconsole.log(response.data);\n\t\t\t\tlocalStorage.setItem(\"oauth2Token\", JSON.stringify(response.data.access_token.value));\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.log(\"error \", err);\n\t\t\t});\n\t}, [useIsMountedRef]);\n\n\tuseEffect(() => {\n\t\tgetToken();\n\t}, [getToken]);\n\n\treturn <Redirect to=\"/phr\" />;\n\t// return <div></div>;\n}\n\nexport default OAuth2;\n"]},"metadata":{},"sourceType":"module"}