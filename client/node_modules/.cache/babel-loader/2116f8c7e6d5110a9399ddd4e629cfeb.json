{"ast":null,"code":"import _classCallCheck from \"/Users/sungwonjung/dev/nodejs/phr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/sungwonjung/dev/nodejs/phr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport jwtDecode from \"jwt-decode\";\nimport axios from \"src/utils/axios\";\n\nvar Axios = require(\"axios\");\n\nvar AuthService = /*#__PURE__*/function () {\n  function AuthService() {\n    var _this = this;\n\n    _classCallCheck(this, AuthService);\n\n    this.setAxiosInterceptors = function (_ref) {\n      var onLogout = _ref.onLogout;\n      axios.interceptors.response.use(function (response) {\n        return response;\n      }, function (error) {\n        if (error.response && error.response.status === 401) {\n          _this.setSession(null);\n\n          if (onLogout) {\n            onLogout();\n          }\n        }\n\n        console.log(\"setAxiosInterceptors\");\n        return Promise.reject(error);\n      });\n    };\n\n    this.loginWithEmailAndPassword = function (email, password) {\n      return new Promise(function (resolve, reject) {\n        Axios.post(\"http://localhost:3100/auth\", {\n          email: email,\n          password: password\n        }).then(function (response) {\n          // console.log(response);\n          response.data.user.avatar = \"/static/images/avatars/avatar_6.png\";\n\n          if (response.data.user) {\n            console.log(response.data);\n\n            _this.setSession(response.data.accessToken);\n\n            resolve(response.data.user);\n          } else {\n            reject(response.data.error);\n          }\n        }).catch(function (error) {\n          reject(error);\n        }); // axios.post('/api/account/login', { email, password })\n        //   .then((response) => {\n        //     if (response.data.user) {\n        //       this.setSession(response.data.accessToken);\n        //       resolve(response.data.user);\n        //     } else {\n        //       reject(response.data.error);\n        //     }\n        //   })\n        //   .catch((error) => {\n        //     reject(error);\n        //   });\n      });\n    };\n\n    this.loginInWithToken = function () {\n      return new Promise(function (resolve, reject) {\n        var config = {\n          method: \"get\",\n          url: \"http://localhost:3100/auth\",\n          headers: {\n            Authorization: \"Bearer \".concat(_this.getAccessToken())\n          }\n        };\n        Axios(config).then(function (response) {\n          console.log(\"loginInWithToken - response \", response.data.user);\n          resolve(response.data.user);\n        }).catch(function (error) {\n          console.log(\"loginInWithToken - error \");\n          reject(error);\n        }); // axios\n        // \t.get(\"/api/account/me\")\n        // \t.then((response) => {\n        // \t\tif (response.data.user) {\n        // \t\t\tresolve(response.data.user);\n        // \t\t} else {\n        // \t\t\treject(response.data.error);\n        // \t\t}\n        // \t})\n        // \t.catch((error) => {\n        // \t\treject(error);\n        // \t});\n      });\n    };\n\n    this.logout = function () {\n      _this.setSession(null);\n    };\n\n    this.setSession = function (accessToken) {\n      if (accessToken) {\n        localStorage.setItem(\"accessToken\", accessToken);\n        axios.defaults.headers.common.Authorization = \"Bearer \".concat(accessToken);\n      } else {\n        localStorage.removeItem(\"accessToken\");\n        delete axios.defaults.headers.common.Authorization;\n      }\n    };\n\n    this.getAccessToken = function () {\n      return localStorage.getItem(\"accessToken\");\n    };\n\n    this.isValidToken = function (accessToken) {\n      if (!accessToken) {\n        return false;\n      }\n\n      var decoded = jwtDecode(accessToken);\n      var currentTime = Date.now() / 1000;\n      return decoded.exp > currentTime;\n    };\n\n    this.isAuthenticated = function () {\n      return !!_this.getAccessToken();\n    };\n  }\n\n  _createClass(AuthService, [{\n    key: \"handleAuthentication\",\n    value: function handleAuthentication() {\n      var accessToken = this.getAccessToken();\n\n      if (!accessToken) {\n        return;\n      }\n\n      if (this.isValidToken(accessToken)) {\n        console.log(\"handleAuthentication - valid token\", accessToken);\n        this.setSession(accessToken);\n      } else {\n        console.log(\"handleAuthentication - not valid token\");\n        this.setSession(null);\n      }\n    }\n  }]);\n\n  return AuthService;\n}();\n\nvar authService = new AuthService();\nexport default authService;","map":{"version":3,"sources":["/Users/sungwonjung/dev/nodejs/phr/client/src/services/authService.js"],"names":["jwtDecode","axios","Axios","require","AuthService","setAxiosInterceptors","onLogout","interceptors","response","use","error","status","setSession","console","log","Promise","reject","loginWithEmailAndPassword","email","password","resolve","post","then","data","user","avatar","accessToken","catch","loginInWithToken","config","method","url","headers","Authorization","getAccessToken","logout","localStorage","setItem","defaults","common","removeItem","getItem","isValidToken","decoded","currentTime","Date","now","exp","isAuthenticated","authService"],"mappings":"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","sourcesContent":["import jwtDecode from \"jwt-decode\";\nimport axios from \"src/utils/axios\";\nconst Axios = require(\"axios\");\n\nclass AuthService {\n\tsetAxiosInterceptors = ({ onLogout }) => {\n\t\taxios.interceptors.response.use(\n\t\t\t(response) => response,\n\t\t\t(error) => {\n\t\t\t\tif (error.response && error.response.status === 401) {\n\t\t\t\t\tthis.setSession(null);\n\n\t\t\t\t\tif (onLogout) {\n\t\t\t\t\t\tonLogout();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log(\"setAxiosInterceptors\");\n\t\t\t\treturn Promise.reject(error);\n\t\t\t}\n\t\t);\n\t};\n\n\thandleAuthentication() {\n\t\tconst accessToken = this.getAccessToken();\n\n\t\tif (!accessToken) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isValidToken(accessToken)) {\n\t\t\tconsole.log(\"handleAuthentication - valid token\", accessToken);\n\t\t\tthis.setSession(accessToken);\n\t\t} else {\n\t\t\tconsole.log(\"handleAuthentication - not valid token\");\n\t\t\tthis.setSession(null);\n\t\t}\n\t}\n\n\tloginWithEmailAndPassword = (email, password) =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tAxios.post(\"http://localhost:3100/auth\", { email, password })\n\t\t\t\t.then((response) => {\n\t\t\t\t\t// console.log(response);\n\t\t\t\t\tresponse.data.user.avatar = \"/static/images/avatars/avatar_6.png\";\n\t\t\t\t\tif (response.data.user) {\n\t\t\t\t\t\tconsole.log(response.data);\n\t\t\t\t\t\tthis.setSession(response.data.accessToken);\n\t\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(response.data.error);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t\t// axios.post('/api/account/login', { email, password })\n\t\t\t//   .then((response) => {\n\t\t\t//     if (response.data.user) {\n\t\t\t//       this.setSession(response.data.accessToken);\n\t\t\t//       resolve(response.data.user);\n\t\t\t//     } else {\n\t\t\t//       reject(response.data.error);\n\t\t\t//     }\n\t\t\t//   })\n\t\t\t//   .catch((error) => {\n\t\t\t//     reject(error);\n\t\t\t//   });\n\t\t});\n\n\tloginInWithToken = () =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tvar config = {\n\t\t\t\tmethod: \"get\",\n\t\t\t\turl: \"http://localhost:3100/auth\",\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${this.getAccessToken()}`,\n\t\t\t\t},\n\t\t\t};\n\t\t\tAxios(config)\n\t\t\t\t.then(function(response) {\n\t\t\t\t\tconsole.log(\"loginInWithToken - response \", response.data.user);\n\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tconsole.log(\"loginInWithToken - error \");\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t\t// axios\n\t\t\t// \t.get(\"/api/account/me\")\n\t\t\t// \t.then((response) => {\n\t\t\t// \t\tif (response.data.user) {\n\t\t\t// \t\t\tresolve(response.data.user);\n\t\t\t// \t\t} else {\n\t\t\t// \t\t\treject(response.data.error);\n\t\t\t// \t\t}\n\t\t\t// \t})\n\t\t\t// \t.catch((error) => {\n\t\t\t// \t\treject(error);\n\t\t\t// \t});\n\t\t});\n\n\tlogout = () => {\n\t\tthis.setSession(null);\n\t};\n\n\tsetSession = (accessToken) => {\n\t\tif (accessToken) {\n\t\t\tlocalStorage.setItem(\"accessToken\", accessToken);\n\t\t\taxios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n\t\t} else {\n\t\t\tlocalStorage.removeItem(\"accessToken\");\n\t\t\tdelete axios.defaults.headers.common.Authorization;\n\t\t}\n\t};\n\n\tgetAccessToken = () => localStorage.getItem(\"accessToken\");\n\n\tisValidToken = (accessToken) => {\n\t\tif (!accessToken) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst decoded = jwtDecode(accessToken);\n\t\tconst currentTime = Date.now() / 1000;\n\n\t\treturn decoded.exp > currentTime;\n\t};\n\n\t// isAuthenticated = () => {\n\t// \tconsole.log(\"isAuthenticated\", this.getAccessToken());\n\t// \t// !!this.getAccessToken();\n\t// \t// return true;\n\t// };\n\n\tisAuthenticated = () => !!this.getAccessToken();\n}\n\nconst authService = new AuthService();\n\nexport default authService;\n"]},"metadata":{},"sourceType":"module"}